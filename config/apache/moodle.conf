<VirtualHost *:80>
    ServerName 3.140.95.210
    ServerAlias localhost
    DocumentRoot /usr/local/apache2/htdocs/moodle
    
    <Directory /usr/local/apache2/htdocs/moodle>
        AllowOverride All
        Require all granted
        DirectoryIndex index.php
        Options FollowSymLinks
    </Directory>
    
    # PHP-FPM Configuration
    <FilesMatch \.php$>
        SetHandler "proxy:fcgi://php:9000"
    </FilesMatch>
    
    # Handle PHP files with path info (required for Moodle)
    <LocationMatch "^(.*\.php)(/.*)?$">
        ProxyPassMatch "fcgi://php:9000/var/www/html$1"
    </LocationMatch>
    
    # Deny access to config.php from web
    <Files "config.php">
        Require all denied
    </Files>
    
    ErrorLog /proc/self/fd/2
    CustomLog /proc/self/fd/1 common
</VirtualHost>
