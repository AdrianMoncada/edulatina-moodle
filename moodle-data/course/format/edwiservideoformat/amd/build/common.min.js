/**
 * Common functionality for Edwiser Video Format.
 *
 * @module     format_edwiservideoformat/common
 * @copyright  Edwiser
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("format_edwiservideoformat/common",["jquery"],(function($){const SELECTORS_COURSE_INDEX_ITEM_LINK=".courseindex-item .courseindex-link[data-for='cm_name']",SELECTORS_ACTIVITY_LINK=".activity-item .activityname  .aalink",registerCommonEvents=()=>{$(document).on("click","".concat(SELECTORS_COURSE_INDEX_ITEM_LINK,", ").concat(SELECTORS_ACTIVITY_LINK),(function(event){event.preventDefault(),event.stopPropagation();const href=$(this).attr("href");if(!href)return;const activityInfo=(url=>{try{const urlObj=new URL(url),pathParts=urlObj.pathname.split("/"),modIndex=pathParts.indexOf("mod");if(-1!==modIndex&&modIndex+2<pathParts.length){const activityType=pathParts[modIndex+1];if("view.php"===pathParts[modIndex+2]){const modId=urlObj.searchParams.get("id");if(modId)return{modtype:activityType,modid:modId}}}return null}catch(error){return null}})(href);if(activityInfo){const redirectUrl=((baseUrl,modtype,modid)=>{try{const urlObj=new URL(baseUrl);return urlObj.searchParams.set("modtype",modtype),urlObj.searchParams.set("modid",modid),urlObj.toString()}catch(error){return baseUrl}})(M.cfg.wwwroot+"/course/view.php?id="+M.cfg.courseId,activityInfo.modtype,activityInfo.modid);window.location.href=redirectUrl}}))};function setCurrentPageItem(){const modid=function(){const modid=new URLSearchParams(window.location.search).get("modid");return modid?parseInt(modid,10):null}(),modtype=new URLSearchParams(window.location.search).get("modtype");if(!modid||!modtype)return;const targetUrl=M.cfg.wwwroot+"/mod/"+modtype+"/view.php?id="+modid;let matchingLink=null;if(matchingLink=$(".courseindex-link").filter((function(){return $(this).attr("href")===targetUrl})),0===matchingLink.length&&(matchingLink=$(".activity-item .activityname a, .activity-item .aalink").filter((function(){return $(this).attr("href")===targetUrl}))),0===matchingLink.length&&(matchingLink=$('a[href="'+targetUrl+'"]')),0===matchingLink.length&&(matchingLink=$('[data-cmid="'+modid+'"]')),matchingLink.length>0){$(".courseindex-item, .activity-item").removeClass("pageitem");const courseIndexItem=matchingLink.closest(".courseindex-item, .activity-item");courseIndexItem.length>0&&courseIndexItem.addClass("pageitem")}}return{init:function(){$(document).ready((function(){registerCommonEvents(),$("body").addClass("edwiservideoformat-"+M.cfg.theme+"-body"),setTimeout(setCurrentPageItem,200),$(".read-more-target").height()>300&&($(".generalsectioninfo").find("#readmorebtn").removeClass("d-none"),$(".read-more-target").addClass("summary-collapsed").removeClass("summary-expanded")),$("#readmorebtn").on("click",(function(){$(".read-more-target").addClass("summary-expanded").removeClass("summary-collapsed"),$(".generalsectioninfo").find("#readmorebtn").addClass("d-none"),$(".generalsectioninfo").find("#readlessbtn").removeClass("d-none")})),$("#readlessbtn").on("click",(function(){$(".read-more-target").addClass("summary-collapsed").removeClass("summary-expanded"),$(".generalsectioninfo").find("#readmorebtn").removeClass("d-none"),$(".generalsectioninfo").find("#readlessbtn").addClass("d-none")})),evfmoodleversion<500?$("body").addClass("edwiservideoformat-moodle-405"):$("body").addClass("edwiservideoformat-moodle-500")}))}}}));

//# sourceMappingURL=common.min.js.map