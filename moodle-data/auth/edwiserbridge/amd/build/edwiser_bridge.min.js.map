{"version":3,"file":"edwiser_bridge.min.js","sources":["../src/edwiser_bridge.js"],"sourcesContent":["/* eslint-disable no-unused-vars */\n// This file is part of Moodle - https://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n/**\n * JS file to handle edwiser bridge.\n *\n * @package\n * @copyright   2021 WisdmLabs (https://wisdmlabs.com/) <support@wisdmlabs.com>\n * @license     https://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n * @author      Wisdmlabs\n * @module      auth_edwiserbridge/edwiser_bridge\n */\ndefine(['jquery', 'core/ajax', 'core/url', 'core/str'], function($, ajax, url) {\n    return {\n        init: function($params) {\n            $(document).ready(function() {\n\n                /**\n                 * Functionality to avoid space in the site name.\n                 */\n                $('input[name^=\"wp_name\"]').on({\n                    keydown: function(e) {\n                        if (e.which === 32) {\n                            return false;\n                        }\n                    },\n                    change: function() {\n                        this.value = this.value.replace(/\\s/g, \"\");\n                    }\n                });\n\n\n                /**\n                 * Functionality to test connection.\n                 */\n                $(\"[id$=_eb_test_connection]\").click(function(event) {\n                    event.preventDefault();\n                    $(document.body).css({ 'cursor': 'wait' });\n                    var id = $(this).prop(\"id\");\n                    id = id.replace(\"eb_test_connection\", '');\n                    id = id.replace(\"id_eb_buttons\", '');\n                    var index = id.replace(/\\_/g, '');\n                    var url = $(\"#id_wp_url_\" + index).val();\n                    var token = $(\"#id_wp_token_\" + index).val();\n                    var parent = $(this).parent().parent();\n                    parent = parent.parent();\n\n                    // Display none the error div.\n                    parent.find(\"#eb_test_conne_response_old\").css(\"display\", \"none\");\n\n                    var promises = ajax.call([\n                        { methodname: 'auth_edwiserbridge_test_connection', args: { wp_url: url, wp_token: token } }\n                    ]);\n\n                    promises[0].done(function(response) {\n                        parent.find(\"#eb_test_conne_response_old\").html(response.msg);\n                        parent.find(\"#eb_test_conne_response_old\").css(\"display\", \"block\");\n\n                        if (response.status == 1) {\n                            parent.find(\"#eb_test_conne_response_old\").addClass(\"eb-success-msg\");\n                            parent.find(\"#eb_test_conne_response_old\").removeClass(\"eb-error-msg\");\n                        } else {\n                            parent.find(\"#eb_test_conne_response_old\").removeClass(\"eb-success-msg\");\n                            parent.find(\"#eb_test_conne_response_old\").addClass(\"eb-error-msg\");\n                        }\n                        $(document.body).css({ 'cursor': 'default' });\n                    }).fail(function(ex) {\n                        // Do something with the exception.\n                        $(document.body).css({ 'cursor': 'default' });\n                    });\n                });\n\n                /**\n                 * Functionality to remove site from the sites list.\n                 */\n                $(\"[id$=_eb_remove_site]\").click(function(event) {\n                    event.preventDefault();\n                    var id = $(this).prop(\"id\");\n                    id = id.replace(\"eb_remove_site\", '');\n                    id = id.replace(\"id_eb_buttons\", '');\n                    var index = id.replace(/\\_/g, '');\n\n                    $(\"#id_wp_url_\" + index).val(\"\");\n                    $(\"#id_wp_token_\" + index).val(\"\");\n                    $(\"#id_wp_name_\" + index).val(\"\");\n\n                    // Hiding elemnts.\n                    onRemoveHideElemnts(index);\n                    $(\"input[name='wp_remove[\" + index + \"]']\").val(\"yes\");\n                });\n\n                /**\n                 * Hide the elements removed from the remove button.\n                 * @param {number} index - Index of the element.\n                 */\n                function onRemoveHideElemnts(index) {\n                    $(\"#id_wp_name_\" + index).closest('fieldset').css(\"display\", \"none\");\n                }\n\n                // Hiding js elements which are already removed.\n                if ($(\"input[name='wp_remove[0]']\").length) {\n                    var repeatQty = $(\"input[name='eb_connection_setting_repeats']\").val();\n                    for (var i = 0; i < repeatQty; i++) {\n                        if (\"yes\" == $(\"input[name='wp_remove[\" + i + \"]']\").val()) {\n                            onRemoveHideElemnts(i);\n                        }\n                    }\n                }\n\n                /**\n                 * Functionlaity to get site synch values on the site change.\n                 */\n                $(\"#id_wp_site_list\").on(\"change\", function() {\n                    var promises = ajax.call([\n                        { methodname: 'auth_edwiserbridge_get_site_data', args: { site_index: $(this).val() } }\n                    ]);\n                    promises[0].done(function(response) {\n                        $('#id_course_enrollment').prop('checked', response.course_enrollment);\n                        $('#id_course_un_enrollment').prop('checked', response.course_un_enrollment);\n                        $('#id_user_creation').prop('checked', response.user_creation);\n                        $('#id_user_deletion').prop('checked', response.user_deletion);\n                        $('#id_course_creation').prop('checked', response.course_creation);\n                        $('#id_course_deletion').prop('checked', response.course_deletion);\n                        $('#id_user_updation').prop('checked', response.user_updation);\n                    }).fail(function(ex) {});\n                });\n            });\n        }\n    };\n\n});\n"],"names":["define","$","ajax","url","init","$params","document","ready","onRemoveHideElemnts","index","closest","css","on","keydown","e","which","change","value","this","replace","click","event","preventDefault","body","id","prop","val","token","parent","find","call","methodname","args","wp_url","wp_token","done","response","html","msg","status","addClass","removeClass","fail","ex","length","repeatQty","i","site_index","course_enrollment","course_un_enrollment","user_creation","user_deletion","course_creation","course_deletion","user_updation"],"mappings":";;;;;;;;;AAwBAA,2CAAO,CAAC,SAAU,YAAa,WAAY,aAAa,SAASC,EAAGC,KAAMC,WAC/D,CACHC,KAAM,SAASC,SACXJ,EAAEK,UAAUC,OAAM,oBAgFLC,oBAAoBC,OACzBR,EAAE,eAAiBQ,OAAOC,QAAQ,YAAYC,IAAI,UAAW,WA5EjEV,EAAE,0BAA0BW,GAAG,CAC3BC,QAAS,SAASC,MACE,KAAZA,EAAEC,aACK,GAGfC,OAAQ,gBACCC,MAAQC,KAAKD,MAAME,QAAQ,MAAO,OAQ/ClB,EAAE,6BAA6BmB,OAAM,SAASC,OAC1CA,MAAMC,iBACNrB,EAAEK,SAASiB,MAAMZ,IAAI,QAAY,aAC7Ba,GAAKvB,EAAEiB,MAAMO,KAAK,MAGlBhB,OADJe,IADAA,GAAKA,GAAGL,QAAQ,qBAAsB,KAC9BA,QAAQ,gBAAiB,KAClBA,QAAQ,MAAO,IAC1BhB,IAAMF,EAAE,cAAgBQ,OAAOiB,MAC/BC,MAAQ1B,EAAE,gBAAkBQ,OAAOiB,MACnCE,OAAS3B,EAAEiB,MAAMU,SAASA,UAC9BA,OAASA,OAAOA,UAGTC,KAAK,+BAA+BlB,IAAI,UAAW,QAE3CT,KAAK4B,KAAK,CACrB,CAAEC,WAAY,qCAAsCC,KAAM,CAAEC,OAAQ9B,IAAK+B,SAAUP,UAG9E,GAAGQ,MAAK,SAASC,UACtBR,OAAOC,KAAK,+BAA+BQ,KAAKD,SAASE,KACzDV,OAAOC,KAAK,+BAA+BlB,IAAI,UAAW,SAEnC,GAAnByB,SAASG,QACTX,OAAOC,KAAK,+BAA+BW,SAAS,kBACpDZ,OAAOC,KAAK,+BAA+BY,YAAY,kBAEvDb,OAAOC,KAAK,+BAA+BY,YAAY,kBACvDb,OAAOC,KAAK,+BAA+BW,SAAS,iBAExDvC,EAAEK,SAASiB,MAAMZ,IAAI,QAAY,eAClC+B,MAAK,SAASC,IAEb1C,EAAEK,SAASiB,MAAMZ,IAAI,QAAY,kBAOzCV,EAAE,yBAAyBmB,OAAM,SAASC,OACtCA,MAAMC,qBACFE,GAAKvB,EAAEiB,MAAMO,KAAK,MAGlBhB,OADJe,IADAA,GAAKA,GAAGL,QAAQ,iBAAkB,KAC1BA,QAAQ,gBAAiB,KAClBA,QAAQ,MAAO,IAE9BlB,EAAE,cAAgBQ,OAAOiB,IAAI,IAC7BzB,EAAE,gBAAkBQ,OAAOiB,IAAI,IAC/BzB,EAAE,eAAiBQ,OAAOiB,IAAI,IAG9BlB,oBAAoBC,OACpBR,EAAE,yBAA2BQ,MAAQ,OAAOiB,IAAI,UAYhDzB,EAAE,8BAA8B2C,eAC5BC,UAAY5C,EAAE,+CAA+CyB,MACxDoB,EAAI,EAAGA,EAAID,UAAWC,IACvB,OAAS7C,EAAE,yBAA2B6C,EAAI,OAAOpB,OACjDlB,oBAAoBsC,GAQhC7C,EAAE,oBAAoBW,GAAG,UAAU,WAChBV,KAAK4B,KAAK,CACrB,CAAEC,WAAY,mCAAoCC,KAAM,CAAEe,WAAY9C,EAAEiB,MAAMQ,UAEzE,GAAGS,MAAK,SAASC,UACtBnC,EAAE,yBAAyBwB,KAAK,UAAWW,SAASY,mBACpD/C,EAAE,4BAA4BwB,KAAK,UAAWW,SAASa,sBACvDhD,EAAE,qBAAqBwB,KAAK,UAAWW,SAASc,eAChDjD,EAAE,qBAAqBwB,KAAK,UAAWW,SAASe,eAChDlD,EAAE,uBAAuBwB,KAAK,UAAWW,SAASgB,iBAClDnD,EAAE,uBAAuBwB,KAAK,UAAWW,SAASiB,iBAClDpD,EAAE,qBAAqBwB,KAAK,UAAWW,SAASkB,kBACjDZ,MAAK,SAASC"}